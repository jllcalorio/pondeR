% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_filterRSD.R
\name{run_filterRSD}
\alias{run_filterRSD}
\title{Filter Features by Relative Standard Deviation in QC Samples}
\usage{
run_filterRSD(
  x,
  metadata,
  max_rsd = 0.3,
  groups = "Group",
  qc_type = "EQC",
  qc_types = c("QC", "SQC", "EQC"),
  verbose = TRUE
)
}
\arguments{
\item{x}{Matrix or data frame. Numeric data with samples in rows and features in columns.}

\item{metadata}{Data frame. Sample metadata with number of rows equal to nrow(x).
Must contain column specified by \code{groups} to identify QC samples.}

\item{max_rsd}{Numeric. Maximum allowed RSD (0-1). Features with RSD >= this
threshold in QC samples are removed. Default: 0.3 (30\%).}

\item{groups}{Character. Name of column in \code{metadata} containing sample group labels.
Default: "Group".}

\item{qc_type}{Character. QC sample type to use for RSD calculation. Options:
\itemize{
\item \code{"EQC"}: Extract QC samples (diluted sample pool)
\item \code{"SQC"}: Sample QC samples (undiluted sample pool)
\item \code{"QC"}: Any QC sample (use when both EQC and SQC present, or no distinction)
}
Default: "EQC".}

\item{qc_types}{Character vector. Group labels that should be treated as QC samples.
Default: c("QC", "SQC", "EQC").}

\item{verbose}{Logical. Print progress messages. Default: TRUE.}
}
\value{
A list of class "run_filterRSD" containing:
\item{data}{Matrix or data frame of filtered data (same class as input \code{x})}
\item{features_removed}{Character vector of removed feature names}
\item{features_kept}{Character vector of retained feature names}
\item{rsd_values}{Numeric vector of RSD values for all original features}
\item{n_features_before}{Integer. Number of features before filtering}
\item{n_features_after}{Integer. Number of features after filtering}
\item{n_features_removed}{Integer. Number of features removed}
\item{parameters}{List of parameters used}
}
\description{
Removes features with high relative standard deviation (RSD, also known as
coefficient of variation) in quality control samples. High RSD indicates
poor analytical reproducibility.
}
\details{
\strong{Relative Standard Deviation (RSD):}

RSD is calculated as: RSD = (SD / Mean) Ã— 100\%

Also known as coefficient of variation (CV), RSD expresses variability
as a percentage of the mean, making it scale-independent and suitable
for comparing features with different magnitudes.

\strong{Why Filter by RSD:}

Quality control samples should have low variability since they represent
the same biological matrix. High RSD in QC samples indicates:
\itemize{
\item Poor analytical reproducibility
\item Instrument instability
\item Ion suppression/enhancement effects
\item Features near detection limit
}

Features with high QC RSD are unreliable and should be removed before
biological interpretation.

\strong{Choosing QC Type:}
\itemize{
\item \strong{EQC} (default): Most commonly used. Represents diluted pooled samples
analyzed regularly throughout the run.
\item \strong{SQC}: Undiluted pooled samples. Use when you have a specific SQC type
distinct from EQC.
\item \strong{QC}: Use when you don't distinguish between QC types, or want to
assess RSD across all QC samples combined.
}

\strong{Typical RSD Thresholds:}
\itemize{
\item Stringent: 20\% (0.2) - high-quality data only
\item Standard: 30\% (0.3) - recommended for most metabolomics studies
\item Lenient: 40\% (0.4) - when sample size is limited
}
}
\examples{
\dontrun{
# Simulate data
set.seed(123)
x <- matrix(abs(rnorm(100 * 50, mean = 100, sd = 20)),
            nrow = 100, ncol = 50)
colnames(x) <- paste0("Feature", 1:50)

# Add high variability to some features in QC samples
qc_rows <- 91:100
x[qc_rows, 1:10] <- x[qc_rows, 1:10] * runif(10 * 10, 0.5, 1.5)

metadata <- data.frame(
  Sample = paste0("S", 1:100),
  Group = c(rep("Control", 40), rep("Treatment", 40), rep("QC", 10), rep("EQC", 10))
)

# Filter by RSD in EQC samples
result <- run_filterRSD(x, metadata, max_rsd = 0.3, qc_type = "EQC")
}
}
\references{
Broadhurst, D.I. (2025). QC:MXP Repeat Injection based Quality Control, Batch Correction,
Exploration & Data Cleaning (Version 2.1) Zendono. \doi{10.5281/zenodo.16824822}.
Retrieved from \url{https://github.com/broadhurstdavid/QC-MXP}.

Jankevics A, Lloyd GR, Weber RJM (2025). pmp: Peak Matrix Processing and signal
batch correction for metabolomics datasets. \doi{10.18129/B9.bioc.pmp},
R package version 1.20.0, \url{https://bioconductor.org/packages/pmp}.
}
\author{
John Lennon L. Calorio
}
